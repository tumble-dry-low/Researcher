# Copilot Instructions — Researcher

This is a **multi-agent research orchestration system**. You have a knowledge base with a CLI (`kb`) that tracks entities, claims, sources, links, and evaluations in a SQLite database.

## Quick Start

```bash
# Check what's in the KB
kb stats

# Search existing research
kb search "your topic"

# Start new research
ID=$(kb add "Research: Your Topic" "Description" '{"type":"research"}')

# Add claims with confidence/credibility scores
kb add-claim "$ID" "Key finding from research" 0.8 0.9

# Add sources
SID=$(kb add-source "https://example.com" "Paper Title" "Relevant excerpt")

# Link source to claim
kb add-claim-source <claim_id> $SID

# Review quality
kb review $ID full

# Generate report
kb report $ID synthesize executive
```

## Agent Architecture

There are **12 agent types** defined in `docs/agents/`. You don't need to read all of them — use `route` to pick the right one:

```bash
# Get a recommendation for which coordinator to use
kb route "Your task description here"
```

### Coordinators (in `docs/agents/coordinators/`)
- **Swarm Coordinator**: Parallel exploration — spawn many agents on different angles, synthesize consensus. Best for uncertain/exploratory research.
- **Hierarchical Planner**: Top-down decomposition into subtasks with dependency tracking. Best for complex structured projects.
- **Pipeline Manager**: Sequential stage chaining with validation gates. Best for linear workflows.

### Specialists (in `docs/agents/specialists/`)
Critic, Synthesizer, Quantitative, Gap Detector, Domain Expert, Monitor, Code Analyzer, Decision Log, Learning Path.

## Spawning Sub-Agents

The KB tracks spawn records and budgets. **Actual agent launching uses copilot-cli's `task` tool** — the KB is bookkeeping only.

```bash
# Check if spawning is allowed (max depth 8, max 400 entities per tree)
kb budget $ENTITY_ID

# Record a spawn in the KB
kb spawn $PARENT_ID "Sub-topic title" "Description" swarm_coordinator

# Get context for a spawned sub-agent
kb context $ENTITY_ID

# Then launch the real agent via copilot-cli task tool:
# task(agent_type="general-purpose", prompt="Research X using kb ...")
```

## Multi-Wave Research Pattern

```bash
# 1. Create root entity
ROOT=$(kb add "Research: Topic" "..." '{"type":"swarm"}')

# 2. Start evaluation loop
EVAL=$(kb add-eval $ROOT 5 '{"min_confidence":0.8}')

# 3. Spawn parallel agents (record in KB + launch via task tool)
kb spawn $ROOT "Angle 1" "..." researcher
kb spawn $ROOT "Angle 2" "..." researcher

# 4. After agents complete, check convergence
kb converged $EVAL

# 5. Review and identify gaps
kb review $ROOT full

# 6. Generate final report
kb report $ROOT synthesize executive
```

## Key Commands

| Command | Purpose |
|---------|---------|
| `stats` | DB overview |
| `search <q> [--all]` | Find existing research |
| `add / get / update / list` | Entity CRUD |
| `add-claim / claims` | Claim management |
| `review <eid> full` | Quality review (4 checks) |
| `qa <eid>` | Batch verification + grading |
| `report <eid> synthesize` | Themed report generation |
| `route <desc>` | Pick best coordinator |
| `spawn / budget / context` | Sub-agent tracking |
| `monitor <eid>` | Tree health dashboard |
| `expert match "topic"` | Domain expert matching |

## Important Notes

- All output is JSON — pipe through `jq` for readability
- Entity IDs are 12-char hex strings (e.g., `ff959ace-f63`)
- Claims are auto-graded (A/B/C/D/F) based on confidence × credibility
- The `review` command combines 4 checks: structural reflection, critique, gap detection, quantitative verification
- FTS5 full-text search supports stemming ("battery" matches "batteries")
- For full CLI reference: `kb help`
- For detailed agent docs: see `docs/agents/`
